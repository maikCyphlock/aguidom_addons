<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Lote list View -->
    <record id="view_avicola_lote_list" model="ir.ui.view">
        <field name="name">avicola.lote.list</field>
        <field name="model">avicola.lote</field>
        <field name="arch" type="xml">
            <list decoration-muted="state in ('vendido', 'descartado')">
                <field name="name"/>
                <field name="galpon_id"/>
                <field name="raza"/>
                <field name="tipo_produccion"/>
                <field name="edad_dias"/>
                <field name="cantidad_actual"/>
                <field name="porcentaje_mortalidad" 
                       decoration-danger="porcentaje_mortalidad > 5"
                       decoration-warning="porcentaje_mortalidad > 2"/>
                <field name="progreso_ciclo" widget="progressbar"/>
                <field name="dias_para_salida"/>
                <field name="state" widget="badge"
                       decoration-info="state == 'borrador'"
                       decoration-success="state == 'activo'"
                       decoration-muted="state == 'vendido'"
                       decoration-danger="state == 'descartado'"/>
            </list>
        </field>
    </record>

    <!-- Lote Form View -->
    <record id="view_avicola_lote_form" model="ir.ui.view">
        <field name="name">avicola.lote.form</field>
        <field name="model">avicola.lote</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_activar" string="Activar" type="object"
                            class="btn-primary"
                            invisible="state != 'borrador'"/>
                    <button name="action_vender" string="Marcar Vendido" type="object"
                            class="btn-success"
                            invisible="state != 'activo'"/>
                    <field name="state" widget="statusbar" statusbar_visible="borrador,activo,vendido"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name"/>
                        <h1>
                            <field name="name" placeholder="Código del Lote"/>
                        </h1>
                    </div>
                    <group>
                        <group string="Información General">
                            <field name="galpon_id"/>
                            <field name="raza"/>
                            <field name="tipo_produccion"/>
                            <field name="fecha_ingreso"/>
                        </group>
                        <group string="Población">
                            <field name="cantidad_inicial"/>
                            <field name="cantidad_actual"/>
                            <field name="edad_dias"/>
                        </group>
                    </group>
                    <group>
                        <group string="Pesos">
                            <field name="peso_inicial_promedio"/>
                            <field name="peso_actual_promedio"/>
                            <field name="peso_objetivo"/>
                        </group>
                        <group string="Proyección">
                            <field name="fecha_salida_proyectada"/>
                            <field name="fecha_salida_real"/>
                            <field name="dias_para_salida"/>
                            <field name="progreso_ciclo" widget="progressbar"/>
                        </group>
                    </group>
                    <group>
                        <group string="Estadísticas">
                            <field name="total_mortalidad"/>
                            <field name="porcentaje_mortalidad"/>
                            <field name="total_huevos" invisible="tipo_produccion != 'ponedora'"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Mortalidad" name="mortalidad">
                            <field name="mortalidad_ids">
                                <list editable="bottom">
                                    <field name="fecha"/>
                                    <field name="cantidad"/>
                                    <field name="causa"/>
                                    <field name="causa_detalle"/>
                                    <field name="registrado_por"/>
                                </list>
                            </field>
                        </page>
                        <page string="Recolección" name="recoleccion" 
                              invisible="tipo_produccion != 'ponedora'">
                            <field name="recoleccion_ids">
                                <list editable="bottom">
                                    <field name="fecha"/>
                                    <field name="cantidad"/>
                                    <field name="clasificacion"/>
                                    <field name="huevos_rotos"/>
                                    <field name="registrado_por"/>
                                </list>
                            </field>
                        </page>
                        <page string="Notas" name="notas">
                            <field name="notas" placeholder="Observaciones del lote..."/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Lote Action -->
    <record id="action_avicola_lote" model="ir.actions.act_window">
        <field name="name">Lotes</field>
        <field name="res_model">avicola.lote</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_state_activo': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Registrar nuevo lote de aves
            </p>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_avicola_lote_search" model="ir.ui.view">
        <field name="name">avicola.lote.search</field>
        <field name="model">avicola.lote</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="galpon_id"/>
                <field name="raza"/>
                <filter name="state_activo" string="Activos" domain="[('state', '=', 'activo')]"/>
                <filter name="state_vendido" string="Vendidos" domain="[('state', '=', 'vendido')]"/>
                <group expand="0" string="Agrupar Por">
                    <filter name="group_galpon" string="Galpón" context="{'group_by': 'galpon_id'}"/>
                    <filter name="group_raza" string="Raza" context="{'group_by': 'raza'}"/>
                    <filter name="group_state" string="Estado" context="{'group_by': 'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Menu -->
    <menuitem id="menu_avicola_lote"
              name="Lotes"
              parent="menu_avicola_operations"
              action="action_avicola_lote"
              sequence="10"/>
</odoo>
