<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ag_podium_base.AttendanceKiosk">
        <div class="o_action_manager h-100 overflow-auto bg-100">
            <div class="container-fluid p-4">
                <!-- Header -->
                <div class="row mb-4 align-items-center bg-white p-3 rounded shadow-sm">
                    <div class="col-md-4">
                        <h2 class="m-0 text-primary">Kiosco de Asistencia</h2>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Fecha</label>
                        <input type="date" class="form-control" t-model="state.date" t-on-change="onDateChange"/>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Categoría</label>
                        <select class="form-select" t-on-change="onCategoryChange">
                            <option value="">Todas</option>
                            <t t-foreach="state.categories" t-as="cat" t-key="cat.id">
                                <option t-att-value="cat.id"><t t-esc="cat.name"/></option>
                            </t>
                        </select>
                    </div>
                    <div class="col-md-2 text-end">
                        <button class="btn btn-primary btn-lg w-100" t-on-click="saveAttendance">
                            <i class="fa fa-save me-2"/>Guardar
                        </button>
                    </div>
                </div>

                <!-- Loading State -->
                <div t-if="state.loading" class="text-center p-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>

                <!-- Athletes Grid -->
                <div t-else="" class="row g-3">
                    <t t-foreach="state.athletes" t-as="athlete" t-key="athlete.id">
                        <div class="col-6 col-md-4 col-lg-3 col-xl-2">
                            <div class="card h-100 cursor-pointer border-0 shadow-sm transition-base" 
                                 t-on-click="() => this.toggleStatus(athlete)"
                                 t-att-class="{
                                    'bg-success-subtle': athlete.status === 'present',
                                    'bg-danger-subtle': athlete.status === 'absent',
                                    'bg-warning-subtle': athlete.status === 'excused'
                                 }">
                                <div class="card-body text-center p-3">
                                    <div class="position-relative d-inline-block mb-2">
                                        <img t-att-src="'/web/image/podium.athlete/' + athlete.id + '/image_128'" 
                                             class="rounded-circle img-thumbnail" 
                                             style="width: 100px; height: 100px; object-fit: cover;"/>
                                        
                                        <!-- Status Badge -->
                                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill"
                                              t-att-class="{
                                                'bg-success': athlete.status === 'present',
                                                'bg-danger': athlete.status === 'absent',
                                                'bg-warning': athlete.status === 'excused'
                                              }">
                                            <i class="fa" t-att-class="{
                                                'fa-check': athlete.status === 'present',
                                                'fa-times': athlete.status === 'absent',
                                                'fa-clock-o': athlete.status === 'excused'
                                            }"/>
                                        </span>
                                    </div>
                                    <h6 class="card-title mb-1 text-truncate"><t t-esc="athlete.name"/></h6>
                                    <p class="text-warning">
                                    <t t-if="athlete.representative_id !== false" t-esc="athlete.representative_id[1]"/>
                                    </p>
                                    <small class="text-muted"><t t-esc="athlete.category_id[1] || 'Sin Categoría'"/></small>
                                    
                                    <div class="mt-2 fw-bold" t-att-class="{
                                        'text-success': athlete.status === 'present',
                                        'text-danger': athlete.status === 'absent',
                                        'text-warning': athlete.status === 'excused'
                                    }">
                                        <t t-if="athlete.status === 'present'">Presente</t>
                                        <t t-elif="athlete.status === 'absent'">Ausente</t>
                                        <t t-else="">Justificado</t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </div>
    </t>
</templates>
