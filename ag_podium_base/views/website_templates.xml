<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="club_dashboard" name="Club Dashboard">
        <t t-call="website.layout">
            <t t-set="head">
                <link rel="preconnect" href="https://fonts.googleapis.com"/>
                <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/>
                <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
            </t>
            <div id="wrap" class="o_portal_wrap" style="background: #f8fafc;">
                <!-- Hero Section - Minimal -->
                <div class="bg-sport-gradient">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h1 class="hero-title display-5 mb-2">
                                    Mi Club Deportivo
                                </h1>
                                <p class="hero-subtitle lead mb-0">
                                    Bienvenido, <span class="fw-semibold text-dark" t-field="partner.name"/>
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-4 mt-md-0">
                                <div class="hero-badge rounded-pill d-inline-block">
                                    <span class="fw-bold text-dark"><t t-esc="athlete_count"/></span> <span class="text-muted">Atletas</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="container py-5">
                    <!-- Payment Alerts - Minimal -->
                    <div class="row mb-4" t-if="missing_payments">
                        <div class="col-12">
                            <t t-set="overdue_count" t-value="len([p for p in missing_payments if not p['is_current']])"/>
                            <t t-set="current_count" t-value="len([p for p in missing_payments if p['is_current']])"/>
                            
                            <div t-if="overdue_count > 0" class="alert alert-danger alert-modern d-flex align-items-center mb-3" role="alert">
                                <div class="flex-shrink-0 me-3">
                                    <i class="fa fa-exclamation-circle text-danger fs-4"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="fw-bold mb-1 text-danger">Pagos Atrasados</h6>
                                    <p class="mb-0 small text-muted">
                                        Tienes <strong class="text-dark" t-esc="overdue_count"/> meses pendientes.
                                    </p>
                                </div>
                            </div>
                            
                            <div t-if="current_count > 0" class="alert alert-warning alert-modern d-flex align-items-center" role="alert">
                                <div class="flex-shrink-0 me-3">
                                    <i class="fa fa-info-circle text-warning fs-4"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="fw-bold mb-1 text-warning">Pago del Mes</h6>
                                    <p class="mb-0 small text-muted">
                                        Recuerda realizar el pago de este mes.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-5">
                        <!-- Athletes Grid -->
                        <div class="col-lg-8 order-lg-1">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h4 class="fw-bold mb-0 text-dark">Mis Atletas</h4>
                            </div>
                            
                            <div class="row g-3">
                                <t t-foreach="athletes" t-as="athlete">
                                    <div class="col-md-6">
                                        <div class="card athlete-card card-sport h-100">
                                            <div class="card-body p-4">
                                                <div class="d-flex align-items-start mb-3">
                                                    <div class="flex-shrink-0 position-relative">
                                                        <t t-set="image_url" t-value="'/web/image/podium.athlete/%s/image_128' % athlete.id"/>
                                                        <img t-att-src="image_url" 
                                                             class="athlete-avatar" 
                                                             alt="Foto Atleta"
                                                             onerror="this.src='/web/static/src/img/placeholder.png'"/>
                                                        <span class="athlete-status-indicator position-absolute bottom-0 end-0 rounded-circle"></span>
                                                    </div>
                                                    <div class="flex-grow-1 ms-3">
                                                        <h6 class="fw-bold mb-1 text-dark">
                                                            <span t-field="athlete.name"/>
                                                        </h6>
                                                        <span class="badge badge-modern badge-gradient-primary mb-2">
                                                            <span t-field="athlete.category_id.name"/>
                                                        </span>
                                                        <div class="text-muted small">
                                                            <span t-field="athlete.age"/> años
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="divider-gradient my-3"></div>
                                                
                                                <div class="row g-2">
                                                    <div class="col-6">
                                                        <div class="stat-card">
                                                            <div class="stat-value">85%</div>
                                                            <small class="text-muted d-block small">Asistencia</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-6">
                                                        <div class="stat-card">
                                                            <div class="stat-value text-success">Activo</div>
                                                            <small class="text-muted d-block small">Estado</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <a href="#" class="btn btn-modern btn-modern-outline w-100 btn-sm">
                                                        Ver Detalles
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                            
                            <!-- Recent Activity Tabs -->
                            <div class="card card-sport mt-4">
                                <div class="card-header bg-white border-0 pt-3 px-3">
                                    <ul class="nav nav-pills" id="clubTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active btn-sm" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button">
                                                Pagos
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link btn-sm" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendance" type="button">
                                                Asistencias
                                            </button>
                                        </li>
                                    </ul>
                                </div>
                                <div class="card-body p-0">
                                    <div class="tab-content" id="clubTabsContent">
                                        <div class="tab-pane fade show active" id="payments" role="tabpanel">
                                            <div class="table-responsive">
                                                <table class="table table-modern mb-0">
                                                    <thead>
                                                        <tr>
                                                            <th class="ps-4">Período</th>
                                                            <th>Atleta</th>
                                                            <th>Monto</th>
                                                            <th class="text-end pe-4">Estado</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="payments" t-as="payment">
                                                            <tr>
                                                                <td class="ps-4">
                                                                    <div class="fw-medium text-dark">
                                                                        <span t-field="payment.month"/> <span t-field="payment.year"/>
                                                                    </div>
                                                                    <small class="text-muted">
                                                                        <span t-field="payment.date"/>
                                                                    </small>
                                                                </td>
                                                                <td class="text-muted"><span t-field="payment.athlete_id.name"/></td>
                                                                <td class="fw-medium text-dark">
                                                                    <span t-field="payment.amount" t-options='{"widget": "monetary", "display_currency": payment.currency_id}'/>
                                                                </td>
                                                                <td class="text-end pe-4">
                                                                    <span t-if="payment.state == 'paid'" class="badge badge-modern badge-gradient-success">
                                                                        Pagado
                                                                    </span>
                                                                    <span t-if="payment.state == 'draft'" class="badge badge-modern bg-light text-muted border">
                                                                        Pendiente
                                                                    </span>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="tab-pane fade" id="attendance" role="tabpanel">
                                            <div class="table-responsive">
                                                <table class="table table-modern mb-0">
                                                    <thead>
                                                        <tr>
                                                            <th class="ps-4">Fecha</th>
                                                            <th>Atleta</th>
                                                            <th class="text-end pe-4">Estado</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <t t-foreach="attendances" t-as="attendance">
                                                            <tr>
                                                                <td class="ps-4 fw-medium text-dark">
                                                                    <span t-field="attendance.date"/>
                                                                </td>
                                                                <td class="text-muted"><span t-field="attendance.athlete_id.name"/></td>
                                                                <td class="text-end pe-4">
                                                                    <span t-if="attendance.status == 'present'" class="badge badge-modern badge-gradient-success">
                                                                        Presente
                                                                    </span>
                                                                    <span t-if="attendance.status == 'absent'" class="badge badge-modern bg-light text-danger border border-danger-subtle">
                                                                        Ausente
                                                                    </span>
                                                                    <span t-if="attendance.status == 'excused'" class="badge badge-modern bg-light text-info border border-info-subtle">
                                                                        Justificado
                                                                    </span>
                                                                </td>
                                                            </tr>
                                                        </t>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Status Sidebar -->
                        <div class="col-lg-4 order-lg-2">
                            <div class="card card-sport h-100">
                                <div class="card-header card-header-sport py-3">
                                    Estado de Cuenta
                                </div>
                                <div class="list-group list-group-flush p-2">
                                    <t t-if="not upcoming_payments and not missing_payments">
                                        <div class="text-center p-4">
                                            <i class="fa fa-check-circle text-success fs-1 mb-2"></i>
                                            <h6 class="fw-bold text-dark">¡Todo al Día!</h6>
                                            <p class="text-muted small mb-0">Sin pagos pendientes</p>
                                        </div>
                                    </t>
                                    
                                    <!-- Missing Payments -->
                                    <t t-foreach="missing_payments" t-as="missed">
                                        <div t-attf-class="list-group-item payment-card p-3 rounded #{'overdue' if not missed['is_current'] else 'pending'}">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small class="text-muted fw-semibold"><span t-esc="missed['month_name']"/></small>
                                                <span t-if="not missed['is_current']" class="badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill" style="font-size: 0.65rem;">VENCIDO</span>
                                                <span t-if="missed['is_current']" class="badge bg-warning-subtle text-warning border border-warning-subtle rounded-pill" style="font-size: 0.65rem;">PENDIENTE</span>
                                            </div>
                                            <h6 class="fw-bold mb-0 text-dark" style="font-size: 0.9rem;">
                                                <span t-esc="missed['athlete_name']"/>
                                            </h6>
                                        </div>
                                    </t>
                                    
                                    <!-- Upcoming Payments -->
                                    <t t-foreach="upcoming_payments" t-as="payment">
                                        <div class="list-group-item payment-card upcoming p-3 rounded">
                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                <small class="text-muted fw-semibold"><span t-field="payment.date"/></small>
                                                <span class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill" style="font-size: 0.65rem;">PRÓXIMO</span>
                                            </div>
                                            <h6 class="fw-bold mb-1 text-dark" style="font-size: 0.9rem;">
                                                <span t-field="payment.athlete_id.name"/>
                                            </h6>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted"><span t-field="payment.name"/></small>
                                                <span class="fw-bold text-dark">
                                                    <span t-field="payment.amount" t-options='{"widget": "monetary", "display_currency": payment.currency_id}'/>
                                                </span>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Menu Item -->
    <record id="menu_club_dashboard" model="website.menu">
        <field name="name">Mi Club</field>
        <field name="url">/club/dashboard</field>
        <field name="parent_id" ref="website.main_menu"/>
        <field name="sequence" type="int">20</field>
    </record>
</odoo>
